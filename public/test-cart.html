<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background: #f5f5f5; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; }
        button { padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        pre { background: #1f2937; color: #10b981; padding: 15px; border-radius: 6px; overflow-x: auto; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>ðŸ›’ Cart Debugging Tool</h1>
    
    <div class="section">
        <h2>Test 1: Check if Alpine.js cart is working</h2>
        <p>Open browser console (F12) and look for:</p>
        <ul>
            <li>"Cart component initialized" message</li>
            <li>Any Alpine.js errors</li>
            <li>Any axios errors</li>
        </ul>
    </div>

    <div class="section">
        <h2>Test 2: Test API Directly</h2>
        <button onclick="testGetCart()">GET /api/cart</button>
        <button onclick="testAddToCart()">POST /api/cart/add (Product ID 1)</button>
        <div id="api-result"></div>
    </div>

    <div class="section">
        <h2>Test 3: Test Alpine Event Dispatch</h2>
        <button onclick="testDispatchEvent()">Dispatch add-to-cart Event</button>
        <p id="event-result"></p>
    </div>

    <div class="section">
        <h2>Test 4: Check if Cart Sidebar Exists</h2>
        <button onclick="checkCartSidebar()">Check Cart Sidebar</button>
        <div id="sidebar-result"></div>
    </div>

    <script>
        async function testGetCart() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<p>Loading...</p>';
            try {
                const response = await axios.get('/api/cart');
                result.innerHTML = `<p class="success">âœ“ Success!</p><pre>${JSON.stringify(response.data, null, 2)}</pre>`;
                console.log('Cart data:', response.data);
            } catch (error) {
                result.innerHTML = `<p class="error">âœ— Error: ${error.message}</p><pre>${JSON.stringify(error.response?.data || error, null, 2)}</pre>`;
                console.error('Error:', error);
            }
        }

        async function testAddToCart() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<p>Adding product...</p>';
            try {
                const response = await axios.post('/api/cart/add', {
                    product_id: 1,
                    quantity: 1
                });
                result.innerHTML = `<p class="success">âœ“ Item added successfully!</p><pre>${JSON.stringify(response.data, null, 2)}</pre>`;
                console.log('Add to cart response:', response.data);
            } catch (error) {
                result.innerHTML = `<p class="error">âœ— Error: ${error.message}</p><pre>${JSON.stringify(error.response?.data || error, null, 2)}</pre>`;
                console.error('Error:', error);
            }
        }

        function testDispatchEvent() {
            const result = document.getElementById('event-result');
            console.log('Dispatching add-to-cart event...');
            window.dispatchEvent(new CustomEvent('add-to-cart', {
                detail: { productId: 1, quantity: 1 }
            }));
            result.innerHTML = '<p class="success">âœ“ Event dispatched! Check console for "Add to cart event received" message</p>';
        }

        function checkCartSidebar() {
            const result = document.getElementById('sidebar-result');
            
            // Check if cart sidebar exists in the parent window (if this is in iframe) or current window
            const checkWindow = (win, name) => {
                const sidebar = win.document.querySelector('[x-show="isOpen"]');
                const alpineData = win.document.querySelector('[x-data="cart"]');
                
                return {
                    window: name,
                    sidebar: sidebar ? 'âœ“ Found' : 'âœ— Not found',
                    alpineData: alpineData ? 'âœ“ Found' : 'âœ— Not found',
                    sidebarHTML: sidebar ? sidebar.outerHTML.substring(0, 200) + '...' : 'N/A'
                };
            };

            const current = checkWindow(window, 'Current Window');
            const parent = window.parent !== window ? checkWindow(window.parent, 'Parent Window') : null;

            let html = `<pre>${JSON.stringify(current, null, 2)}</pre>`;
            if (parent) {
                html += `<pre>${JSON.stringify(parent, null, 2)}</pre>`;
            }

            result.innerHTML = html;
        }

        // Auto-run checks on load
        window.addEventListener('load', () => {
            console.log('=== Cart Debug Page Loaded ===');
            checkCartSidebar();
        });
    </script>
</body>
</html>
